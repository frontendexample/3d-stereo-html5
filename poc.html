<html>
  <head>
    <title>test</title>
  </head>
  <body>
    <select onChange="javascript:img.src=this.value">
      <option value="images/statue2-3D-side-by-side-960.jpg">statue2-3D-side-by-side-960.jpg</option>
      <option value="images/5310631602_dc8361d16e.jpg">5310631602_dc8361d16e.jpg</option>
      <option value="images/masters3dsidebyside1.jpg">masters3dsidebyside1.jpg</option>
      <option value="images/side-by-Side-LCI.jpg">side-by-Side-LCI.jpg</option>
      <option value="images/G-Force-trailer-3D.jpg">G-Force-trailer-3D.jpg</option>
      <option value="images/side-by-side-3d.jpg">side-by-side-3d.jpg</option>
      <option value="images/5305857371_a7b21074a2.jpg">5305857371_a7b21074a2.jpg</option>
    </select>

    <select onChange="javascript:algorythm=this.value;handleImg(img);">
      <option value="default">Default</option>
      <option value="true-anaglyphs">True Anaglyphs</option>
      <option value="optimized-anaglyphs">Optimized Anaglyphs</option>
      <option value="gray-anaglyphs">Gray Anaglyphs</option>
      <option value="color-anaglyphs">Color Anaglyphs</option>
    </select>

    <hr />

    <script>
      var canvas = document.createElement('canvas');
      var algorythm = null;
      var img = new Image;
      img.onload = function() {
        handleImg(img);
      };

      function handleImg(img) {
        halfWidth = img.width / 2;
        canvas.width = img.width;
        //canvas.width = halfWidth;
        canvas.height = img.height;
        var ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        var pixels = imageData.data;
        console.info('canvas.width', canvas.width);
        console.info('canvas.height', canvas.height);
        console.info('pixels.length', pixels.length);
        for (var i = 0, il = pixels.length; i < il; i+= 4) {
          //var color = Math.random() * 255;
          if ((i / 4) % img.width < img.width / 2) {
            var r1 = pixels[i + 0];
            var r2 = pixels[i + 0 + img.width * 2];
            var g1 = pixels[i + 1];
            var g2 = pixels[i + 1 + img.width * 2];
            var b1 = pixels[i + 2];
            var b2 = pixels[i + 2 + img.width * 2];

            switch (algorythm) {
            case 'true-anaglyphs':
              pixels[i + 0] = 0.299 * r1 + 0.587 * g1 + 0.114 * b1;
              pixels[i + 2] = 0.299 * r2 + 0.587 * g2 + 0.114 * b2;
              break;
            case 'optimized-anaglyphs':
              pixels[i + 0] = 0.7 * g1 + 0.3 * b1;
              pixels[i + 1] = g2;
              pixels[i + 2] = b2;
              break;
            case 'gray-anaglyphs':
              pixels[i + 0] = 0.299 * r1 + 0.587 * g1 + 0.114 * b1;
              pixels[i + 1] = 0.299 * r2 + 0.587 * g2 + 0.114 * b2;
              pixels[i + 2] = 0.299 * r2 + 0.587 * g2 + 0.114 * b2;
              break;
            case 'color-anaglyphs':
              pixels[i + 0] = r1;
              pixels[i + 1] = r2;
              pixels[i + 2] = r2;
              break;
            default:
              break;
            }
          } else {
            pixels[i + 0] = 255;
            pixels[i + 1] = 255;
            pixels[i + 2] = 255;
          }
        }
        ctx.putImageData(imageData, 0, 0);
        document.body.appendChild(canvas);
      }
    img.src = 'images/statue2-3D-side-by-side-960.jpg';
    </script>
  </body>
</html>
